#!/bin/sh

start() {
if [ ! -d "/loop" ]; then mkdir /loop ; fi;
	echo "Mounting debian image."
if [ -d "/mnt/usbs/arm-chroot" ]; then
	mount -o bind /mnt/usbs/arm-chroot/ /loop
	mount -o bind /proc /loop/debian/proc
	mount -o bind /dev /loop/debian/dev
	mount -o bind /sys /loop/debian/sys
	export PATH=/loop/root-filesystem-armv4l/usr/sbin:/usr/sbin:/bin:/usr/bin:/sbin:/bin:/sbin:/usr/bin:/usr/sbin:/usr/hddapp/bin:/usr/hddapp/sbin:/usr/local/bin:/usr/local/sbin:/bin:/sbin:/usr/bin:/usr/sbin:/usr/syno/bin:/usr/syno/sbin:/usr/local/bin:/usr/local/sbin:/loop/root-filesystem-armv4l/bin:/loop/debian/bin:/loop/debian/sbin:/loop/debian/usr/bin:/loop/debian/usr/sbin

	chroot /loop/debian
fi;
}

stop() {
echo "Launching Chroot termination scripts"
if [ -d "/loop" ]; then
	kill `ps | grep "chroot /loop/debian" | awk '{print $1;}'` 2>>/dev/null;
        umount /loop/debian/proc
        umount /loop/debian/dev
        umount /loop/debian/sys
	umount /loop
fi;
}

case "$1" in
    start)
        start
    ;;
    stop)
        stop
    ;;
    restart)
        stop
        start
    ;;
    *)
        echo $"Usage: $0 {start|stop|restart}"
        exit 1
esac

exit $?
